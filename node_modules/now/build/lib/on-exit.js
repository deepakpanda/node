"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function checkUpdates(e){var t=(e.debug,e.debounce,e.timeout,void 0),r=check().then(function(e,r){e&&(t=r)},function(e){return console.error(e.stack)});return process.on("exit",function(e){if(t){var r=t,o=r.current,a=r.latest,u=r.at,n=(0,_ms2["default"])(Date.now()-u);console.log("> "+_chalk2["default"].white.bgRed("UPDATE NEEDED")+" "+("Current: "+o+" â€“ ")+("Latest "+_chalk2["default"].bold(a)+" (released "+n+" ago)"))}}),r}function check(e){var t=e.debug,r=e.debounce,o=e.timeout;return new _promise2["default"](function(e,a){var u=cfg.read(),n=u._last_update_check;if(n&&n+r>Date.now()){if(t){var c=(0,_ms2["default"])(Date.now()-n);console.log("> [debug] Skipping update. Last check "+c+" ago.")}}else{t&&console.log("> [debug] Will check for updates. Timeout in "+(0,_ms2["default"])(o)+".");var i=void 0,s=_https2["default"].get("https://registry.npmjs.org/now",function(r){if(200!==r.statusCode)return t&&console.log("> [debug] Update check error. NPM "+r.statusCode+"."),void e(!1);r.resume();var o=[];r.on("data",function(e){return o.push(e)}),r.on("error",function(r){t&&console.log("> [debug] Update check error: "+r.message+"."),e(!1)}),r.on("end",function(){clearTimeout(i);var r=Buffer.concat(o),a=void 0;try{a=JSON.parse(r.toString("utf8"))}catch(u){return t&&console.log("> [debug] Update check JSON parse error: "+u.message+"."),void e(!1)}a.version!==_package2["default"].version&&e(!0,{current:_package2["default"].version,latest:a.version,at:new Date(a.time[a.version])}),cfg.merge({_last_update_check:Date.now()})})}).on("error",function(r){t&&console.log("> [debug] Update check error: "+r.message+"."),e(!1)});i=setTimeout(function(){t&&console.log("> [debug] Aborting update check after "+(0,_ms2["default"])(o)+"."),s.abort(),e(!1)},o)}})}Object.defineProperty(exports,"__esModule",{value:!0});var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise);exports["default"]=checkUpdates;var _ms=require("ms"),_ms2=_interopRequireDefault(_ms),_cfg=require("./cfg"),cfg=_interopRequireWildcard(_cfg),_package=require("../../package"),_package2=_interopRequireDefault(_package),_https=require("https"),_https2=_interopRequireDefault(_https),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),TENM=(0,_ms2["default"])("1m");